# RDB

## 正規化

とてもわかりやすい記事
- [データベース: RDBと第1~3正規形について](https://satoshun.github.io/2015/04/normalization/)

### 第一正規形

第一正規形の定義
1. ある属性に複数の要素が含まれていない
2. データに重複がない
3. 順序が定まっていない

例として、ある学校の学生番号、学生の名前、年齢、通勤が以下のように判明しているとします。

- 学生番号1 鈴木さん(19)
    - 電車, バスで通学
- 学生番号2 佐藤さん(19)
    - 電車で通学
- 学生番号3 小林さん(18)
    - 自転車で通学

このような学生の通学手段を表現するリレーションを考えます(候補キーには@をつけています)。

| @学生番号 | @通学手段  | 名前 | 年齢 | 
| -------- | --------- | ---- | ---- | 
| 1        | 電車,バス | 鈴木 | 19   | 
| 2        | 電車      | 佐藤 | 19   | 
| 3        | 自転車    | 小林 | 18   | 

これを見ると、「通学手段」という属性に複数の要素が入ってしまっているため、第一正規形の定義に反します。定義に沿うよう、このリレーションを変換すると以下が得られます。

| @学生番号 | @通学手段 | 名前 | 年齢 |
| - | - | - | - |
| 1 | 電車 | 鈴木 | 19 |
| 1 | バス | 鈴木 | 19 |
| 2 | 電車 | 佐藤 | 19 |
| 3 | 自転車 | 小林 | 18 |

正規化されていないリレーションに対しこのような変換を行うことを「第一正規化」と言います。

### 第二正規形

先ほど第一正規化を行って得られたリレーションは、学生の名前、年齢を書き換える必要が生じた際に、該当する全ての行を書き換えなければいけません。
候補キー属性である「学生番号」に依存し非キー属性(候補キーでない属性)である「名前」や「年齢」といった情報がリレーション内に重複し得る設計になっているためこうした問題が生じます。このような問題を2つのリレーションに切り出し解決することを「第二正規化」といいます。
実際に先ほどの例に対し第二正規化を行うためには、リレーションを以下のように分割します。

| @学生番号 | @通学手段 |
| - | - |
| 1 | 電車 |
| 1 | バス |
| 2 | 電車 |
| 3 | 自転車 |

| @学生番号 | 名前 | 年齢 |
| - | - | - |
| 1 | 鈴木 | 19 |
| 2 | 佐藤 | 19 |
| 3 | 小林 | 18 |

これで先ほど述べた「学生の名前、年齢を書き換える必要が生じた際に、該当する全ての行を書き換えなければいけない」という問題が無くなります。

### 第三正規形

ここで新たに学生の所属するクラスとその担任の情報を加えた以下のようなリレーションが存在するとします。

| @学生番号 | 名前 | 年齢 | クラス | 担任 |
| - | - | - | - | - |
| 1 | 鈴木 | 19 | A | 高橋 |
| 2 | 佐藤 | 19 | B | 田中 |
| 3 | 小林 | 18 | A | 高橋 |

このリレーションは第二正規形になっているため一見良さそうですが、担任を書き換えようとした際に該当する全ての行を書き換えなければいけないという問題が生じます。
これは「担任」属性が「クラス」属性に依存しているため起きる問題です。「担任」属性のこうした状態を推移的従属性があるといい、推移的従属性がある属性を新たなリレーションに切り出すことを第三正規化と言います。

| @学生番号 | 名前 | 年齢 | クラス |
| - | - | - | - |
| 1 | 鈴木 | 19 | A |
| 2 | 佐藤 | 19 | B |
| 3 | 小林 | 18 | A |

| @クラス | 担任 |
| - | - |
| A | 高橋 |
| B | 田中 |